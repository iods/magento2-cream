<?php
/* @var $block \Dholi\Widgets\Block\Widget\ProductsByCategory */
$items = $block->getItems();
$exist = false;
$alias = null;
$templateType = null;

if ($exist = ($items && $items->getSize())) {
	$alias = 'widget-best-sellers-' . $this->getAlias();
	$templateType = \Magento\Catalog\Block\Product\ReviewRendererInterface::SHORT_VIEW;
}
?>
<?php if ($exist):?>
	<div class="block widget block-best-sellers carousel">
		<div class="block-title">
			<strong role="heading" aria-level="2"><?= $block->escapeHtml(__('Best Sellers')) ?></strong>
		</div>
		<div class="block-content">
			<div id="<?php echo $alias; ?>" class="owl-carousel owl-theme">
				<?php foreach ($items as $_item):?>
					<div>
						<div class="product-item-info">
							<a href="<?= $block->escapeUrl($block->getProductUrl($_item)) ?>"
							   class="product-item-photo">
								<?= $block->getImage($_item, 'category_page_grid')->toHtml() ?>
							</a>
							<div class="product-item-details">
								<strong class="product-item-name">
									<a title="<?= $block->escapeHtml($_item->getName()) ?>"
									   href="<?= $block->escapeUrl($block->getProductUrl($_item)) ?>"
									   class="product-item-link">
										<?= $block->escapeHtml($_item->getName()); ?>
									</a>
								</strong>

								<?= $block->getProductPrice($_item); ?>

								<?php if ($templateType):?>
									<?= $block->getReviewsSummaryHtml($_item, $templateType); ?>
								<?php endif; ?>
							</div>
						</div>
					</div>
				<?php endforeach ?>
			</div>
		</div>
	</div>

	<script type="text/javascript">
		require([
			'jquery',
			'DholiOwlCarousel'
		], function($, owlCarousel) {
			$(document).ready(function () {
				$(<?php echo "'#{$alias}'"?>).owlCarousel({
					loop: true,
					margin: 20,
					dots: false,
					navText: ["", ""],
					rewindNav: true,
					nav: true,
					responsive: {
						0: {
							items: 1
						},
						600: {
							items: 2
						},
						1000: {
							items: 4
						}
					}
				});
			});
		});
	</script>
<?php endif;?>